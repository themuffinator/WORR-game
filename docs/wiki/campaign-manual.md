# WORR Campaign Manual

## Campaign State Overview
`level.campaign` is the authoritative structure for story progress that lives on the server-side `level_locals_t` instance. It accumulates the counts designers expect to surface to players—total vs. found secrets, goals, and monster kills—and also houses auxiliary state used by various campaign subsystems.【F:src/server/g_local.hpp†L2436-L2475】  The structure is reset whenever a savegame repopulates the world, guaranteeing that stale counters and handles (like active boss health bars) are discarded before entities are respawned.【F:src/server/gameplay/g_spawn.cpp†L1940-L1973】  Fresh level boots seed the co-op scaling values (player count and per-player health bonus) from `g_coop_health_scaling`, ensuring monster stats can be re-evaluated as clients join.【F:src/server/gameplay/g_spawn.cpp†L1842-L1855】

Campaign metadata also records disguise violation timers, hub status, and queued story mode auto-save/report times. When a map’s worldspawn flags the level as a hub, the loader clears previously latched help messages and per-client change counters so the hub acts as a neutral staging space instead of contributing to end-of-unit (EOU) tallies.【F:src/server/gameplay/g_spawn.cpp†L2360-L2447】【F:src/server/gameplay/g_spawn.cpp†L2410-L2430】  Designers can additionally supply a tab-delimited `goals` string on worldspawn, which feeds the N64-style rotating mission briefings handled by the HUD messaging helpers.【F:src/server/gameplay/g_spawn.cpp†L2410-L2413】

## Mission Objectives and Points of Interest
Mission scripting leans on lightweight target entities. `target_help` writes either the primary (`HELP1`) or secondary HUD objective and, when `SETPOI` is toggled, forwards to the point-of-interest system with an optional custom icon image.【F:src/server/gameplay/g_target.cpp†L329-L384】  The helper’s use function only updates HUD text when the incoming string changes, keeping modification counters stable for player notification logic.【F:src/server/gameplay/g_target.cpp†L333-L350】

Secrets and story beats use similar hooks. `target_secret` increments the campaign secret tally on use, plays an optional sound, and frees itself so the secret can only be claimed once. Each placed secret also bumps the total secret count during spawn so completion percentages display correctly.【F:src/server/gameplay/g_target.cpp†L388-L425】  Goals behave analogously: `target_goal` increments totals at spawn, awards progress on use, optionally stops the music when all goals are done, and advances the N64 goal pointer so `G_PlayerNotifyGoal` can push the next briefing to every active player.【F:src/server/gameplay/g_target.cpp†L501-L549】  Designers can chain goal activations to other scripted events via regular target/targetname relationships.

The campaign story indicator is toggled through `target_story`, which writes to `level.campaign.story_active` and the `CONFIG_STORY_SCORELIMIT` configstring. This enables story HUD overlays to respond when cinematics or narrative segments are active.【F:src/server/gameplay/g_target.cpp†L2159-L2171】  Collectively, these mission entities give level authors granular control over objective text, POIs, and the pacing of secrets/goals without writing bespoke code.

## Monsters, Scaling, and Player-Facing Stats
Every monster that is allowed to spawn and counts toward completion increments `level.campaign.totalMonsters`; when a counted monster dies, `G_MonsterKilled` advances the kill tally and awards co-op score credit to the attacker. Debug builds can optionally track registration via `monstersRegistered` to validate counts.【F:src/server/gameplay/g_monster.cpp†L1280-L1345】【F:src/server/gameplay/g_monster.cpp†L724-L752】  The campaign struct’s coop fields let the game recalculate health bonuses whenever a player joins: `G_Monster_CheckCoopHealthScaling` iterates monsters flagged for scaling and raises their current/max health to match the latest `coopScalePlayers` value.【F:src/server/gameplay/g_monster.cpp†L1280-L1307】【F:src/server/player/p_client.cpp†L3208-L3231】  Those player counts originate from spawn-time bookkeeping, and `g_spawn` reinitializes the scaling inputs on every map load so calculations start from a known baseline.【F:src/server/gameplay/g_spawn.cpp†L1842-L1855】

Kill, goal, and secret data flow directly into player-facing UI. The help computer layout renders campaign totals from `level.campaign` so players can monitor progress mid-mission, while cooperative HUD stats surface the remaining monster count during Horde matches by subtracting `killedMonsters` from `totalMonsters`.【F:src/server/player/p_hud_main.cpp†L334-L385】【F:src/server/player/p_hud_main.cpp†L398-L414】  End-of-unit summaries reuse the same counters: each level entry records the final monster and secret tallies, and the EOU table aggregates them—optionally including a totals row—to recap the unit before transitioning.【F:src/server/player/p_hud_main.cpp†L102-L180】  Because hub maps are flagged to opt out of EOU tallies, designers can build connective spaces without polluting campaign completion statistics.【F:src/server/g_local.hpp†L2467-L2475】
